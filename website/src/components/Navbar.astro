---
import { t, type Language } from '../utils/i18n';
import LanguageSelect from './LanguageSelect.astro';

interface Props {
  lang?: Language;
}

const { lang = 'es' } = Astro.props;
const currentPath = Astro.url.pathname;
---

<nav class={`flex justify-between items-center px-8 py-4 static z-50 transition-all duration-300 bg-white dark:bg-zinc-900 shadow-xs ${
  currentPath !== "/" 
    ? "border-b border-zinc-300 dark:border-zinc-700"
    : "border-b border-main/25 dark:border-amber-500/25"
}`}>
  <div class="flex items-center gap-4 select-none">
    <a href="/" class="flex items-center select-none">
      <img src="/Logo.svg" alt="The Recipes App" width="40" height="40" />
    </a>
    <LanguageSelect lang={lang} />
  </div>

  <div class="hidden md:flex gap-4 items-center select-none">
    <a
      href="/"
      class="px-4 py-2 rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 font-semibold text-sm transition-all duration-300 active:scale-95 hover:bg-zinc-200 dark:hover:bg-zinc-700/20 hover:shadow-sm select-none"
    >
      {t("home", lang, "Navbar")}
    </a>
    <a
      href="/privacy"
      class="px-4 py-2 rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 font-semibold text-sm transition-all duration-300 active:scale-95 hover:bg-zinc-200 dark:hover:bg-zinc-700/20 hover:shadow-sm select-none"
    >
      {t("privacy", lang, "Navbar")}
    </a>
    <a
      href="https://github.com/francids/the_recipes"
      target="_blank"
      rel="noopener noreferrer"
      class="px-4 py-2 rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 font-semibold text-sm transition-all duration-300 active:scale-95 hover:bg-zinc-200 dark:hover:bg-zinc-700/20 hover:shadow-sm select-none"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
      </svg>
    </a>
  </div>

  <button
    id="mobile-menu-button"
    class="md:hidden flex flex-col justify-between h-5 w-7 bg-transparent border-none cursor-pointer z-10"
    aria-label="MenÃº"
  >
    <span class="w-full h-0.5 rounded-full bg-zinc-900 dark:bg-white transition-all"></span>
    <span class="w-full h-0.5 rounded-full bg-zinc-900 dark:bg-white transition-all"></span>
    <span class="w-full h-0.5 rounded-full bg-zinc-900 dark:bg-white transition-all"></span>
  </button>

  <div
    id="mobile-menu"
    class="fixed top-[70px] left-0 right-0 flex flex-col gap-4 m-0 p-6 shadow-lg rounded-b-lg md:hidden transition-opacity duration-300 ease-in-out opacity-0 pointer-events-none bg-white dark:bg-zinc-800 border-t border-zinc-200 dark:border-zinc-700 z-40"
  >
    <a
      href="/"
      class="font-medium py-2 text-zinc-800 dark:text-zinc-100 hover:text-orange-600 dark:hover:text-orange-400 mobile-menu-link"
    >
      {t("home", lang, "Navbar")}
    </a>
    <a
      href="/privacy"
      class="font-medium py-2 text-zinc-800 dark:text-zinc-100 hover:text-orange-600 dark:hover:text-orange-400 mobile-menu-link"
    >
      {t("privacy", lang, "Navbar")}
    </a>
    <a
      href="https://github.com/francids/the_recipes"
      target="_blank"
      rel="noopener noreferrer"
      class="font-medium py-2 text-zinc-800 dark:text-zinc-100 hover:text-orange-600 dark:hover:text-orange-400 mobile-menu-link"
    >
      GitHub
    </a>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuLinks = document.querySelectorAll('.mobile-menu-link');
    let isMenuOpen = false;

    function toggleMenu() {
      isMenuOpen = !isMenuOpen;
      if (isMenuOpen) {
        mobileMenu?.classList.remove('opacity-0', 'pointer-events-none');
        mobileMenu?.classList.add('opacity-100', 'pointer-events-auto');
        document.body.style.overflow = 'hidden';
      } else {
        mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
        mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
        document.body.style.overflow = '';
      }
    }

    function closeMenu() {
      if (isMenuOpen) {
        toggleMenu();
      }
    }

    menuButton?.addEventListener('click', toggleMenu);
    
    // Close menu when clicking on links
    menuLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // Close menu when clicking outside
    document.addEventListener('click', (event) => {
      if (isMenuOpen && mobileMenu && menuButton) {
        if (!mobileMenu.contains(event.target as Node) && !menuButton.contains(event.target as Node)) {
          closeMenu();
        }
      }
    });

    // Close menu on window resize
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && isMenuOpen) {
        closeMenu();
      }
    });
  });
</script>