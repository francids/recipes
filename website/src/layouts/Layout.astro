---
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import ScrollTopButton from "../components/ScrollTopButton.astro";
import { detectUserLocale } from "../utils/i18n";
import "../styles/global.css";

export interface Props {
  title?: string;
  description?: string;
}

const currentLang = detectUserLocale(Astro.request);
Astro.cookies.set("locale", currentLang, {
  httpOnly: false,
  path: "/",
  maxAge: 60 * 60 * 24 * 365,
  sameSite: "lax",
});

interface Translation {
  description: string;
  ogDescription: string;
  locale: string;
}

const translations: Record<string, Translation> = {
  en: {
    description:
      "Your digital recipe book - Store, organize and easily find all your favorite recipes",
    ogDescription:
      "Your digital recipe book: save, organize and easily find all your favorite recipes",
    locale: "en_US",
  },
  es: {
    description:
      "Tu libro de recetas digital - Almacena, organiza y encuentra fácilmente todas tus recetas favoritas",
    ogDescription:
      "Tu recetario digital: guarda, organiza y encuentra fácilmente todas tus recetas favoritas",
    locale: "es_ES",
  },
  fr: {
    description:
      "Votre livre de recettes numérique - Stockez, organisez et trouvez facilement toutes vos recettes préférées",
    ogDescription:
      "Votre livre de recettes numérique : sauvegardez, organisez et trouvez facilement toutes vos recettes préférées",
    locale: "fr_FR",
  },
  de: {
    description:
      "Ihr digitales Rezeptbuch - Speichern, organisieren und finden Sie alle Ihre Lieblingsrezepte",
    ogDescription:
      "Ihr digitales Rezeptbuch: Speichern, organisieren und finden Sie alle Ihre Lieblingsrezepte",
    locale: "de_DE",
  },
  it: {
    description:
      "Il tuo libro di ricette digitale - Archivia, organizza e trova facilmente tutte le tue ricette preferite",
    ogDescription:
      "Il tuo libro di ricette digitale: salva, organizza e trova facilmente tutte le tue ricette preferite",
    locale: "it_IT",
  },
  ja: {
    description:
      "あなたのデジタルレシピブック - お気に入りのレシピを保存、整理、簡単検索",
    ogDescription:
      "あなたのデジタルレシピブック：お気に入りのレシピを保存、整理、簡単検索",
    locale: "ja_JP",
  },
  ko: {
    description:
      "당신의 디지털 레시피북 - 좋아하는 레시피를 저장, 정리하고 쉽게 찾으세요",
    ogDescription:
      "당신의 디지털 레시피북: 좋아하는 레시피를 저장, 정리하고 쉽게 찾으세요",
    locale: "ko_KR",
  },
  pt: {
    description:
      "Seu livro de receitas digital - Armazene, organize e encontre facilmente todas as suas receitas favoritas",
    ogDescription:
      "Seu livro de receitas digital: salve, organize e encontre facilmente todas as suas receitas favoritas",
    locale: "pt_PT",
  },
  zh: {
    description: "您的数字食谱书 - 存储、整理并轻松找到您所有喜爱的食谱",
    ogDescription: "您的数字食谱书：保存、整理并轻松找到您所有喜爱的食谱",
    locale: "zh_CN",
  },
};

const t =
  translations[currentLang as keyof typeof translations] || translations.en;

const { title = "The Recipes", description = t.description } = Astro.props;

const theme = Astro.cookies.get("theme")?.value || "system";
---

<html lang={currentLang}>
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} id="meta-description" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#18181b"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#ffffff"
    />
    <meta property="og:title" content={title} id="og-title" />
    <meta
      property="og:description"
      content={t.ogDescription}
      id="og-description"
    />
    <meta
      property="og:image"
      content="https://recipes.francids.com/opengraph-image.png"
    />
    <meta property="og:url" content="https://recipes.francids.com" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content={t.locale} id="og-locale" />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:locale:alternate" content="fr_FR" />
    <meta property="og:locale:alternate" content="de_DE" />
    <meta property="og:locale:alternate" content="it_IT" />
    <meta property="og:locale:alternate" content="ja_JP" />
    <meta property="og:locale:alternate" content="ko_KR" />
    <meta property="og:locale:alternate" content="pt_PT" />
    <meta property="og:locale:alternate" content="zh_CN" />

    <script is:inline define:vars={{ theme }}>
      (() => {
        try {
          if (
            theme === "dark" ||
            (!theme &&
              window.matchMedia("(prefers-color-scheme: dark)").matches) ||
            (theme === "system" &&
              window.matchMedia("(prefers-color-scheme: dark)").matches)
          ) {
            document.documentElement.classList.add("dark");
            document.documentElement.style.backgroundColor = "#18181b";
          } else {
            document.documentElement.style.backgroundColor = "#ffffff";
          }
        } catch (e) {}
      })();
    </script>
  </head>

  <body class="bg-white dark:bg-zinc-900 min-h-screen">
    <Navbar />
    <slot />
    <Footer />
    <ScrollTopButton />
  </body>
</html>

<script>
  import "../utils/ThemeManager";
  import "../utils/MenuManager";

  function handleScroll() {
    const currentScrollY = window.scrollY;
    const scrollButton = document.getElementById("scroll-to-top");

    if (scrollButton) {
      if (currentScrollY > 300) {
        scrollButton.classList.remove(
          "opacity-0",
          "invisible",
          "translate-y-4"
        );
        scrollButton.classList.add("opacity-100", "visible", "translate-y-0");
      } else {
        scrollButton.classList.add("opacity-0", "invisible", "translate-y-4");
        scrollButton.classList.remove(
          "opacity-100",
          "visible",
          "translate-y-0"
        );
      }
    }
  }

  window.addEventListener("scroll", handleScroll);
</script>
